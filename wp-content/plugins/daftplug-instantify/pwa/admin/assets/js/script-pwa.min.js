jQuery((function(){"use strict";var daftplugAdmin=jQuery('.daftplugAdmin[data-daftplug-plugin="daftplug_instantify"]'),optionName=daftplugAdmin.attr("data-daftplug-plugin"),objectName=window[optionName+"_admin_js_vars"];daftplugAdmin.find(".daftplugAdminSettings_form").on("submit",(function(e){e.preventDefault();var action=optionName+"_generate_launch_screens",canvas=document.createElement("canvas");canvas.width=2048,canvas.height=2732;var image=new Image;image.src=jQuery("#pwaIcon").attr("data-attach-url"),image.onload=function(){var ctx=canvas.getContext("2d");ctx.fillStyle=jQuery("#pwaBackgroundColor").val(),ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(image,canvas.width/2-image.width/2,canvas.height/2-image.height/2);var launchScreen=canvas.toDataURL("image/png");jQuery.ajax({url:ajaxurl,type:"POST",data:{action:action,launchScreen:launchScreen},beforeSend:function(){},success:function(response,textStatus,jqXhr){},complete:function(){},error:function(jqXhr,textStatus,errorThrown){}})}})),daftplugAdmin.on("click",".daftplugAdminTable_action.-send, .daftplugAdminButton.-sendNotification",(function(e){var self=jQuery(this),openPopup=self.attr("data-open-popup"),popup=daftplugAdmin.find('[data-popup="'+openPopup+'"]'),subscription=self.attr("data-subscription"),form=popup.find(".daftplugAdminSendPush_form"),pushSegmentSelect=form.find("#pushSegment"),pushSegmentDropdown=form.find('.daftplugAdminInputSelect_dropdown[data-name="pushSegment"]'),pushSegmentList=form.find('.daftplugAdminInputSelect_list[data-name="pushSegment"]');pushSegmentSelect.val(subscription),pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").removeClass("-selected"),pushSegmentList.find('.daftplugAdminInputSelect_option[data-value="'+subscription+'"]').addClass("-selected"),pushSegmentDropdown.attr("data-value",subscription).text(pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").find(".daftplugAdminInputSelect_text").text())})),daftplugAdmin.on("click",".daftplugAdminTable_action.-remove",(function(e){var self=jQuery(this),row=self.closest(".daftplugAdminTable_row"),action=optionName+"_handle_subscription",method="remove",endpoint=self.attr("data-subscription");jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,method:method,endpoint:endpoint},beforeSend:function(){row.addClass("-disabled")},success:function(response,textStatus,jqXhr){row.remove(),jQuery(".daftplugAdminButton.-sendAll").remove()},complete:function(){},error:function(jqXhr,textStatus,errorThrown){row.remove(),jQuery(".daftplugAdminButton.-sendAll").remove()}})})),daftplugAdmin.on("input paste","#subscribersFilter",(function(e){var self,searchPhrase=jQuery(this).val();searchPhrase=jQuery.trim(searchPhrase).replace(/ +/g," ").toLowerCase(),daftplugAdmin.find("tbody").find(".daftplugAdminTable_row").show().filter((function(e){var a;return-1===jQuery(this).text().replace(/\s+/g," ").toLowerCase().indexOf(searchPhrase)})).hide()})),daftplugAdmin.find(".daftplugAdminSendPush_form").on("submit",(function(e){e.preventDefault();var self=jQuery(this),button=self.find(".daftplugAdminButton.-submit"),responseText=self.find(".daftplugAdminField_response"),action=optionName+"_send_notification",nonce=self.attr("data-nonce"),pushSegment=self.find("#pushSegment"),pushTitle=self.find("#pushTitle"),pushBody=self.find("#pushBody"),pushImage=self.find("#pushImage"),pushUrl=self.find("#pushUrl"),pushIcon=self.find("#pushIcon"),pushActionButton1Text=self.find("#pushActionButton1Text"),pushActionButton1Url=self.find("#pushActionButton1Url"),pushActionButton2Text=self.find("#pushActionButton2Text"),pushActionButton2Url=self.find("#pushActionButton2Url");jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,nonce:nonce,pushSegment:pushSegment.val(),pushTitle:pushTitle.val(),pushBody:pushBody.val(),pushImage:pushImage.val(),pushUrl:pushUrl.val(),pushIcon:pushIcon.val(),pushActionButton1Text:pushActionButton1Text.val(),pushActionButton1Url:pushActionButton1Url.val(),pushActionButton2Text:pushActionButton2Text.val(),pushActionButton2Url:pushActionButton2Url.val()},beforeSend:function(){button.addClass("-loading")},success:function(response,textStatus,jqXhr){1==response?(button.addClass("-success"),setTimeout((function(){button.removeClass("-loading -success")}),1500),responseText.css("color","#4073FF").html("Notification sent successfully.").fadeIn("fast").delay(3e3).fadeOut("fast",(function(){responseText.empty().show()})),self.trigger("reset"),pushImage.val("").removeClass("-hasFile").removeAttr("data-attach-url"),pushIcon.val("").removeClass("-hasFile").removeAttr("data-attach-url"),self.find(".daftplugAdminMinifielset_close").trigger("click")):(button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html("Sending push notification failed.").fadeIn("fast")),console.log(response)},complete:function(){},error:function(jqXhr,textStatus,errorThrown){button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html("Sending push notification failed.").fadeIn("fast"),console.log(jqXhr)}})}))}));