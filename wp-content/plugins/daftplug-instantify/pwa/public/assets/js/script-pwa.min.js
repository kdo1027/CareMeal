jQuery((function(){"use strict";var daftplugPublic=jQuery('.daftplugPublic[data-daftplug-plugin="daftplug_instantify"]'),optionName=daftplugPublic.attr("data-daftplug-plugin"),objectName=window[optionName+"_public_js_vars"],uaparser=new UAParser,pushButton=daftplugPublic.find(".daftplugPublicPushButton"),pushPrompt=daftplugPublic.find(".daftplugPublicPushPrompt"),navigationTabBar=daftplugPublic.find(".daftplugPublicNavigationTabBar"),webShareButton=daftplugPublic.find(".daftplugPublicWebShareButton"),isMobileTablet="mobile"==uaparser.getDevice().type||"tablet"==uaparser.getDevice().type,isAndroidChrome="Android"==uaparser.getOS().name&&uaparser.getBrowser().name.includes("Chrome"),isAndroidFirefox="Android"==uaparser.getOS().name&&uaparser.getBrowser().name.includes("Firefox"),isAndroidOpera="Android"==uaparser.getOS().name&&uaparser.getBrowser().name.includes("Opera"),isIosSafari="iOS"==uaparser.getOS().name&&uaparser.getBrowser().name.includes("Safari"),isAndroidPwa="Android"==uaparser.getOS().name&&isPwa(),isIosPwa="iOS"==uaparser.getOS().name&&isPwa(),isFirstVisit=getCookie("firstVisit"),isFullscreenOverlayShown=getCookie("fullscreenOverlay"),isHeaderOverlayShown=getCookie("headerOverlay"),isMenuOverlayShown=getCookie("menuOverlay"),isCheckoutOverlayShown=getCookie("checkoutOverlay"),isPostOverlayShown=getCookie("postOverlay"),isPushPromptShown=getCookie("pushPrompt"),fullscreenOverlay=daftplugPublic.find(".daftplugPublicFullscreenOverlay"),chromeFullscreenOverlay=fullscreenOverlay.filter(".-chrome"),firefoxFullscreenOverlay=fullscreenOverlay.filter(".-firefox"),operaFullscreenOverlay=fullscreenOverlay.filter(".-opera"),safariFullscreenOverlay=fullscreenOverlay.filter(".-safari"),headerOverlay=daftplugPublic.find(".daftplugPublicHeaderOverlay"),menuOverlay=daftplugPublic.find(".daftplugPublicMenuOverlay"),checkoutOverlay=daftplugPublic.find(".daftplugPublicCheckoutOverlay"),postOverlay=daftplugPublic.find(".daftplugPublicPostOverlay"),installButton=daftplugPublic.find(".daftplugPublicInstallButton"),rotateNotice=daftplugPublic.find(".daftplugPublicRotateNotice");function isFacebookApp(){var ua=navigator.userAgent||navigator.vendor||window.opera;return ua.indexOf("FBAN")>-1||ua.indexOf("FBAV")>-1}if(!isFacebookApp()){if("serviceWorker"in navigator&&"PushManager"in window&&!jQuery('meta[name="onesignal"]').length&&navigator.serviceWorker.ready.then((function(registration){registration.pushManager.getSubscription().then((function(subscription){updatePushDevice(),"on"==objectName.settings.pwaPushPrompt&&!subscription&&"denied"!==Notification.permission&&null==isPushPromptShown&&pushPrompt.length&&setTimeout((function(){pushPrompt.addClass("-show").on("click",".daftplugPublicPushPrompt_allow",(function(e){pushPrompt.addClass("-hide").one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",(function(){pushPrompt.remove()})),registerPushDevice()})).on("click",".daftplugPublicPushPrompt_dismiss",(function(e){pushPrompt.addClass("-hide").one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",(function(){pushPrompt.remove()})),setCookie("pushPrompt","shown",1)}))}),2e3),"on"==objectName.settings.pwaPushButton&&(subscription?"shown"==objectName.settings.pwaPushButtonBehavior?changePushButtonState("enabled"):changePushButtonState("hidden"):changePushButtonState("disabled"),pushButton.css("display","flex").on("click",(function(e){"shown"==objectName.settings.pwaPushButtonBehavior?registration.pushManager.getSubscription().then((function(subscription){subscription?deregisterPushDevice():registerPushDevice()})):registerPushDevice().then(()=>changePushButtonState("hidden"))})))}))})),"on"==objectName.settings.pwaOfflineForms&&Array.from(document.querySelectorAll("form")).forEach(form=>{new OfflineForm(form)}),"on"==objectName.settings.pwaAjaxify){if(""==objectName.settings.pwaAjaxifySelectors)var additionalSelectors="a:not(.no-ajaxy)";else var additionalSelectors="a:not(.no-ajaxy),"+objectName.settings.pwaAjaxifySelectors;if("on"==objectName.settings.pwaAjaxifyForms)var formsSelector="form:not(.no-ajaxy)";else var formsSelector=!1;new Ajaxify({elements:"body",selector:additionalSelectors,forms:formsSelector,refresh:!0,deltas:!1,alwayshints:"daftplug-instantify"})}if("on"==objectName.settings.pwaPreloader){var perfData=window.performance.timing,EstimatedTime=-(perfData.loadEventEnd-perfData.navigationStart),time=100*parseInt(EstimatedTime/1e3%60),start=0,end=70,duration=time,range=70,current=0,increment=1,stepTime=Math.abs(Math.floor(duration/70));switch(objectName.settings.pwaPreloaderStyle){case"percent":jQuery(window).on("beforeunload pronto.request",(function(e){e.returnValue="",jQuery(".daftplugPublicPreloader").css("display","flex").hide().fadeIn(200)}));var progressFill=jQuery(".daftplugPublicPreloader_fill"),counter=jQuery(".daftplugPublicPreloader_counter"),timer=setInterval((function(){if(current<70&&(current+=1),progressFill.css({"transition-duration":"0.001s",width:current+"%"}),counter.text(current+"%"),70==current&&perfData.loadEventEnd>0||perfData.loadEventEnd>0){var endLoading=setInterval((function(){current+=1,progressFill.css("width",current+"%"),counter.text(current+"%"),100==current&&(setTimeout((function(){jQuery(".daftplugPublicPreloader").fadeOut(500,(function(e){progressFill.css("width","0"),counter.text("0%")}))}),300),clearInterval(endLoading))}),1);clearInterval(timer)}}),stepTime);break;case"skeleton":jQuery(window).on("beforeunload pronto.request",(function(e){e.returnValue="",jQuery(".daftplugPublicPreloader").css("display","flex").hide().fadeIn(200)}));var timer=setInterval((function(){if(current<70&&(current+=1),jQuery(".daftplugPublicPreloader").hide(),jQuery("a, svg, i, input, select, button, video").addClass("-daftplugPublicSkeletonLoad"),jQuery("img:visible, audio:visible, video:visible, iframe:visible").each((function(e){jQuery(this).wrap(`<div class="${jQuery(this).attr("class")} -daftplugPublicSkeletonLoad -media" style="width: ${jQuery(this).width()}px; height: ${jQuery(this).height()}px;"></div>`).hide()})),jQuery("*:visible").filter((function(){return this.currentStyle?"none"!==this.currentStyle.backgroundImage:window.getComputedStyle?"none"!==document.defaultView.getComputedStyle(this,null).getPropertyValue("background-image"):void 0})).addClass("-daftplugPublicSkeletonLoad"),jQuery("*:visible").filter((function(){return 0==jQuery(this).children().length&&jQuery(this).text().trim().length>0})).addClass("-daftplugPublicSkeletonLoad"),jQuery("*").not("iframe, .-daftplugPublicSkeletonLoad").contents().each((function(){3==this.nodeType&&""!=this.nodeValue.trim()&&jQuery(this).wrap('<ins class="-daftplugPublicSkeletonLoad"/>')})),70==current&&perfData.loadEventEnd>0||perfData.loadEventEnd>0){var endLoading=setInterval((function(){100==(current+=1)&&(jQuery(".-daftplugPublicSkeletonLoad.-media").contents().unwrap().show(),jQuery('ins[class="-daftplugPublicSkeletonLoad"]').contents().unwrap(),jQuery("*").removeClass("-daftplugPublicSkeletonLoad"),jQuery("#daftplugPublicSkeletonLoadCss").remove(),clearInterval(endLoading))}),1);clearInterval(timer)}}),stepTime);break;case"fade":jQuery(window).on("beforeunload pronto.request",(function(e){e.returnValue="",jQuery(document.body).removeClass("-daftplugPublicFadeIn").addClass("-daftplugPublicFadeOut")}));var timer=setInterval((function(){if(current<70&&(current+=1),70==current&&perfData.loadEventEnd>0||perfData.loadEventEnd>0){var endLoading=setInterval((function(){100==(current+=1)&&(jQuery(document.body).removeClass("-daftplugPublicFadeOut").addClass("-daftplugPublicFadeIn"),clearInterval(endLoading))}),1);clearInterval(timer)}}),stepTime);break;default:jQuery(window).on("beforeunload pronto.request",(function(e){e.returnValue="",jQuery(".daftplugPublicPreloader").css("display","flex").hide().fadeIn(200)}));var timer=setInterval((function(){if(current<70&&(current+=1),70==current&&perfData.loadEventEnd>0||perfData.loadEventEnd>0){var endLoading=setInterval((function(){100==(current+=1)&&(setTimeout((function(){jQuery(".daftplugPublicPreloader").fadeOut(500)}),300),clearInterval(endLoading))}),1);clearInterval(timer)}}),stepTime)}}if("on"==objectName.settings.pwaPersistentStorage&&navigator.storage&&navigator.storage.persist&&async function(){var isPersisted;await navigator.storage.persisted()||await navigator.storage.persist()}(),isMobileTablet){var directSearchItem,directSearchLink,shakeEvent;if("on"==objectName.settings.pwaNavigationTabBar)if(0==navigationTabBar.find("li").length)navigationTabBar.hide();else navigationTabBar.is(":visible")&&(setInterval((function(e){jQuery("#daftplugPublicToastMessage").css("bottom","85px")}),10),"on"==objectName.settings.pwaPushButton&&objectName.settings.pwaPushButtonPosition.indexOf("bottom")>=0&&pushButton.length&&pushButton.css("bottom","75px"),"on"==objectName.settings.pwaWebShareButton&&objectName.settings.pwaWebShareButtonPosition.indexOf("bottom")>=0&&webShareButton.length&&webShareButton.css("bottom","75px")),navigationTabBar.find(".daftplugPublicNavigationTabBar_item.-directSearch").find(".daftplugPublicNavigationTabBar_link").on("click",(function(e){e.preventDefault();var self,searchContainer=jQuery(this).prev(),searchForm=searchContainer.find(".daftplugPublicNavigationTabBar_searchForm"),searchField=searchForm.find(".daftplugPublicNavigationTabBar_searchField");searchContainer.fadeIn("fast",(function(e){searchField.trigger("focus").blur((function(e){searchForm[0].reset(),searchContainer.fadeOut("fast")}))}))}));if("on"==objectName.settings.pwaWebShareButton&&navigator.share&&webShareButton.css("display","flex").on("click",(function(e){navigator.share({title:document.title,url:document.querySelector("link[rel=canonical]")?document.querySelector("link[rel=canonical]").href:document.location.href}).catch(console.error)})),"on"==objectName.settings.pwaPullDownNavigation&&(PullToNavigate(),jQuery("#daftplugPublicPullDownNavigation").css("background",objectName.settings.pwaPullDownNavigationBgColor)),"on"==objectName.settings.pwaSwipeNavigation&&jQuery("body").attr("data-xthreshold","111").swipeleft((function(){window.history.back(),jQuery.toast({title:objectName.settings.pwaSwipeBackMsg,duration:3e3,position:"bottom"})})).swiperight((function(){window.history.forward(),jQuery.toast({title:objectName.settings.pwaSwipeForwardMsg,duration:3e3,position:"bottom"})})),"on"==objectName.settings.pwaShakeToRefresh)new Shake({threshold:15}).start(),window.addEventListener("shake",(function(){location.reload()}),!1);if("on"==objectName.settings.pwaScreenWakeLock&&"wakeLock"in navigator){var wakeLock=null,requestWakeLock=async function requestWakeLock(){wakeLock=await navigator.wakeLock.request("screen")},handleVisibilityChange=function handleVisibilityChange(){null!==wakeLock&&"visible"===document.visibilityState&&requestWakeLock()};requestWakeLock(),document.addEventListener("visibilitychange",handleVisibilityChange),document.addEventListener("fullscreenchange",handleVisibilityChange)}if("on"==objectName.settings.pwaVibration&&jQuery("body").vibrate(),"on"==objectName.settings.pwaOverlays)if("on"==objectName.settings.pwaOverlaysSkip&&null==isFirstVisit)setCookie("firstVisit","done",9999),sessionStorage.setItem("firstVisit","true");else if(!sessionStorage.getItem("firstVisit")){if(objectName.settings.pwaOverlaysTypes.includes("fullscreen")&&0==isAndroidPwa&&0==isIosPwa&&null==isFullscreenOverlayShown&&fullscreenOverlay.length){if(objectName.settings.pwaOverlaysBrowsers.includes("chrome")&&isAndroidChrome&&chromeFullscreenOverlay.length){var isFullscreenOverlayFired=!1,installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,isFullscreenOverlayFired||setTimeout((function(){chromeFullscreenOverlay.fadeIn("fast",(function(e){isFullscreenOverlayFired=!0,chromeFullscreenOverlay.on("click",".daftplugPublicFullscreenOverlay_button",(function(e){chromeFullscreenOverlay.fadeOut("fast",(function(e){setCookie("fullscreenOverlay","shown",objectName.settings.pwaOverlaysShowAgain),installPromptEvent.prompt(),installPromptEvent=null}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay)}))}else objectName.settings.pwaOverlaysBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){firefoxFullscreenOverlay.fadeIn("fast")}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){operaFullscreenOverlay.fadeIn("fast")}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){safariFullscreenOverlay.fadeIn("fast")}),1e3*objectName.settings.pwaOverlaysDelay);fullscreenOverlay.on("click",".daftplugPublicFullscreenOverlay_close",(function(e){fullscreenOverlay.fadeOut("fast",(function(e){setCookie("fullscreenOverlay","shown",objectName.settings.pwaOverlaysShowAgain)}))}))}if(objectName.settings.pwaOverlaysTypes.includes("header")&&0==isAndroidPwa&&0==isIosPwa&&null==isHeaderOverlayShown&&headerOverlay.length){if(objectName.settings.pwaOverlaysBrowsers.includes("chrome")&&isAndroidChrome){var isHeaderOverlayFired=!1,installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,isHeaderOverlayFired||setTimeout((function(){headerOverlay.css("display","flex").hide().fadeIn("fast",(function(e){isHeaderOverlayFired=!0,headerOverlay.on("click",".daftplugPublicHeaderOverlay_button",(function(e){headerOverlay.fadeOut("fast",(function(e){setCookie("headerOverlay","shown",objectName.settings.pwaOverlaysShowAgain),installPromptEvent.prompt(),installPromptEvent=null}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay)}))}else objectName.settings.pwaOverlaysBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){headerOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicHeaderOverlay_button",(function(e){headerOverlay.fadeOut("fast",(function(e){setCookie("headerOverlay","shown",objectName.settings.pwaOverlaysShowAgain),firefoxFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){firefoxFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){headerOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicHeaderOverlay_button",(function(e){headerOverlay.fadeOut("fast",(function(e){setCookie("headerOverlay","shown",objectName.settings.pwaOverlaysShowAgain),operaFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){operaFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){headerOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicHeaderOverlay_button",(function(e){headerOverlay.fadeOut("fast",(function(e){setCookie("headerOverlay","shown",objectName.settings.pwaOverlaysShowAgain),safariFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){safariFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay);headerOverlay.on("click",".daftplugPublicHeaderOverlay_dismiss",(function(e){headerOverlay.fadeOut("fast",(function(e){setCookie("headerOverlay","shown",objectName.settings.pwaOverlaysShowAgain)}))}))}if(objectName.settings.pwaOverlaysTypes.includes("menu")&&0==isAndroidPwa&&0==isIosPwa&&null==isMenuOverlayShown&&menuOverlay.length){if(objectName.settings.pwaOverlaysBrowsers.includes("chrome")&&isAndroidChrome){var isMenuOverlayFired=!1,installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,setTimeout((function(){isMenuOverlayFired||menuOverlay.css("display","flex").hide().fadeIn("fast",(function(e){isMenuOverlayFired=!0,menuOverlay.on("click",".daftplugPublicMenuOverlay_install",(function(e){menuOverlay.fadeOut("fast",(function(e){setCookie("menuOverlay","shown",objectName.settings.pwaOverlaysShowAgain),installPromptEvent.prompt(),installPromptEvent=null}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay)}))}else objectName.settings.pwaOverlaysBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){menuOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicMenuOverlay_install",(function(e){menuOverlay.fadeOut("fast",(function(e){setCookie("menuOverlay","shown",objectName.settings.pwaOverlaysShowAgain),firefoxFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){firefoxFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){menuOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicMenuOverlay_install",(function(e){menuOverlay.fadeOut("fast",(function(e){setCookie("menuOverlay","shown",objectName.settings.pwaOverlaysShowAgain),operaFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){operaFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){menuOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicMenuOverlay_install",(function(e){menuOverlay.fadeOut("fast",(function(e){setCookie("menuOverlay","shown",objectName.settings.pwaOverlaysShowAgain),safariFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){safariFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay);menuOverlay.on("click",".daftplugPublicMenuOverlay_dismiss",(function(e){menuOverlay.fadeOut("fast",(function(e){setCookie("menuOverlay","shown",objectName.settings.pwaOverlaysShowAgain)}))}))}if(objectName.settings.pwaOverlaysTypes.includes("checkout")&&0==isAndroidPwa&&0==isIosPwa&&null==isCheckoutOverlayShown&&checkoutOverlay.length){if(objectName.settings.pwaOverlaysBrowsers.includes("chrome")&&isAndroidChrome){var isCheckoutOverlayFired=!1,installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,setTimeout((function(){isCheckoutOverlayFired||checkoutOverlay.css("display","flex").hide().fadeIn("fast",(function(e){isCheckoutOverlayFired=!0,checkoutOverlay.on("click",".daftplugPublicCheckoutOverlay_install",(function(e){checkoutOverlay.fadeOut("fast",(function(e){setCookie("checkoutOverlay","shown",objectName.settings.pwaOverlaysShowAgain),installPromptEvent.prompt(),installPromptEvent=null}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay)}))}else objectName.settings.pwaOverlaysBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){checkoutOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicCheckoutOverlay_install",(function(e){checkoutOverlay.fadeOut("fast",(function(e){setCookie("checkoutOverlay","shown",objectName.settings.pwaOverlaysShowAgain),firefoxFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){firefoxFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){checkoutOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicCheckoutOverlay_install",(function(e){checkoutOverlay.fadeOut("fast",(function(e){setCookie("checkoutOverlay","shown",objectName.settings.pwaOverlaysShowAgain),operaFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){operaFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){checkoutOverlay.css("display","flex").hide().fadeIn("fast").on("click",".daftplugPublicCheckoutOverlay_install",(function(e){checkoutOverlay.fadeOut("fast",(function(e){setCookie("checkoutOverlay","shown",objectName.settings.pwaOverlaysShowAgain),safariFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){safariFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay);checkoutOverlay.on("click",".daftplugPublicCheckoutOverlay_dismiss",(function(e){checkoutOverlay.fadeOut("fast",(function(e){setCookie("checkoutOverlay","shown",objectName.settings.pwaOverlaysShowAgain)}))}))}if(objectName.settings.pwaOverlaysTypes.includes("post")&&0==isAndroidPwa&&0==isIosPwa&&null==isPostOverlayShown&&postOverlay.length){if(objectName.settings.pwaOverlaysBrowsers.includes("chrome")&&isAndroidChrome){var isPostOverlayFired=!1,installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,setTimeout((function(){isPostOverlayFired||postOverlay.fadeIn("fast",(function(e){isPostOverlayFired=!0,postOverlay.on("click",".daftplugPublicPostOverlayAction_button.-install",(function(e){postOverlay.fadeOut("fast",(function(e){setCookie("postOverlay","shown",objectName.settings.pwaOverlaysShowAgain),installPromptEvent.prompt(),installPromptEvent=null}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay)}))}else objectName.settings.pwaOverlaysBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){postOverlay.fadeIn("fast").on("click",".daftplugPublicPostOverlayAction_button.-install",(function(e){postOverlay.fadeOut("fast",(function(e){setCookie("postOverlay","shown",objectName.settings.pwaOverlaysShowAgain),firefoxFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){firefoxFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){postOverlay.fadeIn("fast").on("click",".daftplugPublicPostOverlayAction_button.-install",(function(e){postOverlay.fadeOut("fast",(function(e){setCookie("postOverlay","shown",objectName.settings.pwaOverlaysShowAgain),operaFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){operaFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay):objectName.settings.pwaOverlaysBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){postOverlay.fadeIn("fast").on("click",".daftplugPublicPostOverlayAction_button.-install",(function(e){postOverlay.fadeOut("fast",(function(e){setCookie("postOverlay","shown",objectName.settings.pwaOverlaysShowAgain),safariFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){safariFullscreenOverlay.fadeOut("fast")}))}))}))}),1e3*objectName.settings.pwaOverlaysDelay);postOverlay.on("click",".daftplugPublicPostOverlayAction_button.-dismiss",(function(e){postOverlay.fadeOut("fast",(function(e){setCookie("postOverlay","shown",objectName.settings.pwaOverlaysShowAgain)}))}))}}if("on"==objectName.settings.pwaInstallButton&&0==isAndroidPwa&&0==isIosPwa&&installButton.length)if(objectName.settings.pwaInstallButtonBrowsers.includes("chrome")&&isAndroidChrome){var installPromptEvent=void 0;window.addEventListener("beforeinstallprompt",(function(event){event.preventDefault(),installPromptEvent=event,setTimeout((function(){installButton.css("display","inline-block").on("click",(function(e){installPromptEvent.prompt(),installPromptEvent=null}))}),1e3)}))}else objectName.settings.pwaInstallButtonBrowsers.includes("firefox")&&isAndroidFirefox&&firefoxFullscreenOverlay.length?setTimeout((function(){installButton.css("display","inline-block").on("click",(function(e){firefoxFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){firefoxFullscreenOverlay.fadeOut("fast")}))}))}),1e3):objectName.settings.pwaInstallButtonBrowsers.includes("opera")&&isAndroidOpera&&operaFullscreenOverlay.length?setTimeout((function(){installButton.css("display","inline-block").on("click",(function(e){operaFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){operaFullscreenOverlay.fadeOut("fast")}))}))}),1e3):objectName.settings.pwaInstallButtonBrowsers.includes("safari")&&isIosSafari&&safariFullscreenOverlay.length&&setTimeout((function(){installButton.css("display","inline-block").on("click",(function(e){safariFullscreenOverlay.fadeIn("fast").on("click",".daftplugPublicFullscreenOverlay_close",(function(e){safariFullscreenOverlay.fadeOut("fast")}))}))}),1e3);(isAndroidPwa||isIosPwa)&&setInterval((function(){("portrait"==objectName.settings.pwaOrientation&&window.matchMedia("(orientation: landscape)").matches||"landscape"==objectName.settings.pwaOrientation&&window.matchMedia("(orientation: portrait)").matches)&&(rotateNotice.css("display","flex"),window.onorientationchange=function(e){rotateNotice.hide()})}),100)}window.onappinstalled=function(e){jQuery.ajax({url:objectName.ajaxUrl,dataType:"text",type:"POST",data:{action:optionName+"_save_installation_analytics"},beforeSend:function(){console.log("saving")},success:function(response,textStatus,jqXhr){console.log("saved")},complete:function(){},error:function(jqXhr,textStatus,errorThrown){console.log(jqXhr)}})}}function isPwa(){return["fullscreen","standalone","minimal-ui"].some(displayMode=>window.matchMedia("(display-mode: "+displayMode+")").matches)}function setCookie(name,value,days){var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toUTCString()}document.cookie=name+"="+(value||"")+expires+"; path=/"}function getCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function removeCookie(name){setCookie(name,"",-1)}function changePushButtonState(state){switch(state){case"enabled":pushButton.removeClass("-loading").removeClass("-on").addClass("-off");break;case"disabled":pushButton.removeClass("-loading").removeClass("-off").addClass("-on");break;case"computing":pushButton.removeClass("-on").removeClass("-off").addClass("-loading");break;case"incompatible":pushButton.removeClass("-loading").removeClass("-off").addClass("-on").addClass("-disabled");break;case"hidden":pushButton.removeClass("-loading").removeClass("-off").removeClass("-on").addClass("-hidden");break;default:console.error("Unhandled push button state",state)}}function urlBase64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4),base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/"),rawData=window.atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray}function checkNotificationPermission(){return new Promise((resolve,reject)=>"denied"===Notification.permission?reject(new Error("Push messages are blocked.")):"granted"===Notification.permission?resolve():"default"===Notification.permission?Notification.requestPermission().then(result=>{"granted"!==result&&reject(new Error("Bad permission result")),resolve()}):void 0)}function registerPushDevice(){return changePushButtonState("computing"),checkNotificationPermission().then(()=>navigator.serviceWorker.ready).then(serviceWorkerRegistration=>serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(objectName.pwaPublicKey)})).then(subscription=>(jQuery.toast({title:objectName.pwaSubscribeOnMsg,duration:2500,position:"bottom"}),handleSubscription(subscription,"add"))).then(subscription=>subscription&&changePushButtonState("enabled")).catch(e=>{"denied"===Notification.permission?(console.warn("Notifications are denied by the user."),changePushButtonState("incompatible")):(console.error("Impossible to subscribe to push notifications",e),changePushButtonState("disabled"))})}function updatePushDevice(){navigator.serviceWorker.ready.then(serviceWorkerRegistration=>serviceWorkerRegistration.pushManager.getSubscription()).then(subscription=>{if(changePushButtonState("disabled"),subscription)return handleSubscription(subscription,"update")}).then(subscription=>subscription&&changePushButtonState("enabled")).catch(e=>{console.error("Error when updating the subscription",e)})}function deregisterPushDevice(){changePushButtonState("computing"),navigator.serviceWorker.ready.then(serviceWorkerRegistration=>serviceWorkerRegistration.pushManager.getSubscription()).then(subscription=>{if(subscription)return jQuery.toast({title:objectName.pwaSubscribeOffMsg,duration:2500,position:"bottom"}),handleSubscription(subscription,"remove");changePushButtonState("disabled")}).then(subscription=>subscription.unsubscribe()).then(()=>changePushButtonState("disabled")).catch(e=>{console.error("Error when unsubscribing the user",e),changePushButtonState("disabled")})}function handleSubscription(subscription,method){const action=optionName+"_handle_subscription",endpoint=subscription.endpoint,userKey=subscription.getKey("p256dh"),userAuth=subscription.getKey("auth");if(isMobileTablet)var deviceInfo=uaparser.getBrowser().name+" on "+uaparser.getDevice().vendor+" "+uaparser.getDevice().model;else var deviceInfo=uaparser.getBrowser().name+" on "+uaparser.getOS().name+" "+uaparser.getOS().version;const contentEncoding=(PushManager.supportedContentEncodings||["aesgcm"])[0];return jQuery.ajax({url:objectName.ajaxUrl,type:"POST",data:{method:method,action:action,endpoint:endpoint,userKey:userKey?btoa(String.fromCharCode.apply(null,new Uint8Array(userKey))):null,userAuth:userAuth?btoa(String.fromCharCode.apply(null,new Uint8Array(userAuth))):null,deviceInfo:deviceInfo,contentEncoding:contentEncoding},beforeSend:function(){},success:function(response,textStatus,jqXhr){},complete:function(){},error:function(jqXhr,textStatus,errorThrown){}}).then(()=>subscription)}}));